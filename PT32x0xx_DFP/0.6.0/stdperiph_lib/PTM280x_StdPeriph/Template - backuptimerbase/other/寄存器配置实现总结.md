# 寄存器级配置实现总结

## 概述
根据 `chatgpt_notes.md` 的要求，已将 PTM280x 双向 DCDC 控制器的初始化代码从 FWLib 调用改为直接寄存器级配置。

## 主要修改内容

### 1. main.c - 系统初始化
- **RCC_Configuration()**: 直接写 RCC->APBENR1/2/3 和 RCC->AHBENR 启用所需外设时钟
- **GPIO_AFIO_Configuration()**: 配置引脚复用功能
  - PA5 → TIM1_CH1 (AF1), PA7 → TIM1_CH1N (AF1) 
  - PB12 → TIM1_BKIN (AF3)
  - PA15 → UART0_TX (AF5), PB2 → UART0_RX (AF5)
  - PA3/PA4 → ADC 模拟输入
- **UART 配置**: 替换为寄存器级 BRR, CR, IER 配置

### 2. dcdc_control.c - TIM1 PWM 控制
- **fun_DCDC_Init()**: TIM1 寄存器级配置
  - 50kHz PWM 频率 (48MHz/960)
  - 互补输出 CH1/CH1N，约 200ns 死区时间
  - 刹车输入：BKIN + CMP0
  - ADC 触发：TIM1 更新事件
- **PWM 占空比控制**: 直接写 TIM1->OCR1
- **刹车控制**: 软件刹车 + 硬件刹车集成

### 3. adc_monitor.c - ADC 采样
- **fun_ADC_Init()**: ADC0 寄存器级配置
  - 双通道扫描 (CH3/CH4) 对应 Vin/Vout
  - TIM1 外部触发，连续转换模式
  - 12位分辨率，右对齐
- **ADC 读取函数**: 直接访问 ADC0->DR

### 4. LDAC + CMP0 比较器
- **LDAC**: 5位 DAC 提供参考电压
- **CMP0**: 正端外部信号，负端 LDAC 输出
- **集成**: CMP0 输出连接到 TIM1 刹车输入

## 引脚映射 (符合 notes 要求)
```
PA5  → TIM1_CH1    (PWM 高侧)
PA7  → TIM1_CH1N   (PWM 低侧)  
PB12 → TIM1_BKIN   (紧急关断)
PA15 → UART0_TX    (调试串口)
PB2  → UART0_RX    (调试串口)
PA3  → ADC_IN3     (Vin 采样)
PA4  → ADC_IN4     (Vout 采样)
```

## 外设工作频率
- TIM1 PWM: 50kHz，死区时间 ~200ns
- ADC 采样: TIM1 触发，约 50kHz 采样率
- UART0: 115200bps (可调整)
- 系统时钟: 48MHz

## 特色功能
1. **互补 PWM**: 自动死区保护，防止上下管同时导通
2. **硬件保护**: 比较器超阈值自动刹车
3. **同步采样**: PWM 周期同步触发 ADC 转换
4. **双向控制**: Buck/Boost 模式占空比自动适配

## 编译说明
所有代码使用寄存器直接访问，无需额外 HAL 库依赖。确保包含正确的 PT32x0xx.h 头文件以获取寄存器定义。