

# ðŸ“‘ PTM280x å¯„å­˜å™¨é€ŸæŸ¥è¡¨

## 1. RCC (æ—¶é’ŸæŽ§åˆ¶)

* åŸºåœ°å€ï¼š`0x4002 1000`
* å¸¸ç”¨å¯„å­˜å™¨ï¼š

  * `RCC_AHBENR`   â€“ AHB å¤–è®¾æ—¶é’Ÿä½¿èƒ½
  * `RCC_APB1ENR` â€“ APB1 å¤–è®¾æ—¶é’Ÿä½¿èƒ½
  * `RCC_APB2ENR` â€“ APB2 å¤–è®¾æ—¶é’Ÿä½¿èƒ½

    * `TIM1EN`  (bit 11) â†’ TIM1 æ—¶é’Ÿ
    * `USART0EN`(bit 14) â†’ UART0 æ—¶é’Ÿ
    * `ADC0EN`  (bit 9)  â†’ ADC0 æ—¶é’Ÿ
    * `COMPEN`  (bit 31) â†’ CMP/OPA æ—¶é’Ÿ

---

## 2. GPIO (é€šç”¨ I/O)

* åŸºåœ°å€ï¼š`0x4800 0000` (GPIOA), `0x4800 0400` (GPIOB)
* å¸¸ç”¨å¯„å­˜å™¨ï¼š

  * `GPIOx_MODER` â€“ æ¨¡å¼å¯„å­˜å™¨ (00=è¾“å…¥, 01=è¾“å‡º, 10=å¤ç”¨, 11=æ¨¡æ‹Ÿ)
  * `GPIOx_AFRL/AFRH` â€“ å¤ç”¨åŠŸèƒ½é€‰æ‹©
  * `GPIOx_OTYPER` â€“ è¾“å‡ºç±»åž‹ (0=æŽ¨æŒ½, 1=å¼€æ¼)
  * `GPIOx_OSPEEDR` â€“ è¾“å‡ºé€Ÿåº¦
  * `GPIOx_PUPDR` â€“ ä¸Šä¸‹æ‹‰

**ä¾‹**ï¼šé…ç½® PA5 ä¸º TIM1\_CH1ï¼š

```c
GPIOA->MODER   &= ~(3U<<(5*2));
GPIOA->MODER   |=  (2U<<(5*2));  // å¤ç”¨åŠŸèƒ½
GPIOA->AFR[0]  |=  (AF2<<(5*4)); // AF2: TIM1_CH1
```

---

## 3. TIM1 (é«˜çº§å®šæ—¶å™¨)

* åŸºåœ°å€ï¼š`0x4001 2C00`
* å¸¸ç”¨å¯„å­˜å™¨ï¼š

  * `TIM1_CR1`   â€“ æŽ§åˆ¶å¯„å­˜å™¨1 (CEN, CMS, DIR)
  * `TIM1_CR2`   â€“ æŽ§åˆ¶å¯„å­˜å™¨2 (TRGO è§¦å‘è¾“å‡ºé€‰æ‹©)
  * `TIM1_SMCR`  â€“ ä»Žæ¨¡å¼æŽ§åˆ¶ (åŒæ­¥è§¦å‘)
  * `TIM1_DIER`  â€“ ä¸­æ–­/äº‹ä»¶ä½¿èƒ½
  * `TIM1_SR`    â€“ çŠ¶æ€å¯„å­˜å™¨
  * `TIM1_EGR`   â€“ äº‹ä»¶å‘ç”Ÿå¯„å­˜å™¨
  * `TIM1_CCMR1/2` â€“ æ•èŽ·æ¯”è¾ƒæ¨¡å¼ (PWMæ¨¡å¼è®¾ç½®)
  * `TIM1_CCER`  â€“ è¾“å‡ºä½¿èƒ½ (CHxE/CHxNE)
  * `TIM1_BDTR`  â€“ æ­»åŒºæ—¶é—´ & ä¸»è¾“å‡ºä½¿èƒ½ (MOE, BKIN)
  * `TIM1_PSC`   â€“ é¢„åˆ†é¢‘å™¨
  * `TIM1_ARR`   â€“ è‡ªåŠ¨é‡è£…å€¼ (è®¾å®šPWMå‘¨æœŸ)
  * `TIM1_CCRx`  â€“ é€šé“å ç©ºæ¯”æ¯”è¾ƒå€¼ (è®¾å®šPWMå ç©ºæ¯”)

---

## 4. ADC0

* åŸºåœ°å€ï¼š`0x4001 2400`
* å¸¸ç”¨å¯„å­˜å™¨ï¼š

  * `ADC_CR`    â€“ æŽ§åˆ¶å¯„å­˜å™¨ (ADEN, ADSTART)
  * `ADC_CFGR1` â€“ é…ç½®1 (è§¦å‘æºé€‰æ‹©, åˆ†è¾¨çŽ‡)
  * `ADC_CFGR2` â€“ é…ç½®2 (é‡‡æ ·æ—¶é—´)
  * `ADC_CHSELR` â€“ é€šé“é€‰æ‹©
  * `ADC_DR`    â€“ æ•°æ®å¯„å­˜å™¨ (è¯»å–è½¬æ¢ç»“æžœ)
  * `ADC_ISR`   â€“ çŠ¶æ€ (EOC, EOS)
  * `ADC_IER`   â€“ ä¸­æ–­ä½¿èƒ½

**å…³é”®ä½**ï¼š

* `EXTEN` (è§¦å‘è¾¹æ²¿) / `EXTSEL` (å¤–éƒ¨è§¦å‘æº = TIM1\_TRGO)
* `RES[1:0]` = 00 â†’ 12 ä½

---

## 5. CMP (æ¯”è¾ƒå™¨) + LDAC

* åŸºåœ°å€ï¼š`0x4001 3C00`
* å¸¸ç”¨å¯„å­˜å™¨ï¼š

  * `CMPx_CSR` â€“ é…ç½®å¯„å­˜å™¨

    * `CMPEN`   â†’ å¯ç”¨æ¯”è¾ƒå™¨
    * `INPSEL`  â†’ é€‰æ‹©æ­£ç«¯è¾“å…¥ (ADCé€šé“/OPAè¾“å‡º)
    * `INNSEL`  â†’ é€‰æ‹©è´Ÿç«¯è¾“å…¥ (LDAC, BG1V0, å¤–éƒ¨å¼•è„š)
    * `POL`     â†’ è¾“å‡ºæžæ€§
    * `OUTSEL`  â†’ è¾“å‡ºåˆ° EXTI / TIM1\_BKIN
  * `LDAC_CR` â€“ å†…éƒ¨ 5 ä½ DAC é…ç½® (è¾“å‡º 0\~VDDA\*31/32)

---

## 6. UART0

* åŸºåœ°å€ï¼š`0x4001 3800`
* å¸¸ç”¨å¯„å­˜å™¨ï¼š

  * `USART_BRR`  â€“ æ³¢ç‰¹çŽ‡å¯„å­˜å™¨
  * `USART_CR1`  â€“ æŽ§åˆ¶1 (UE, TE, RE, RXNEIE)
  * `USART_CR2`  â€“ æŽ§åˆ¶2 (åœæ­¢ä½)
  * `USART_CR3`  â€“ æŽ§åˆ¶3 (DMA, ç¡¬ä»¶æµæŽ§)
  * `USART_ISR`  â€“ çŠ¶æ€ (TXE, RXNE, TC)
  * `USART_TDR`  â€“ å‘é€æ•°æ®å¯„å­˜å™¨
  * `USART_RDR`  â€“ æŽ¥æ”¶æ•°æ®å¯„å­˜å™¨

**å…³é”®ä½**ï¼š

* `UE` = 1 â†’ ä½¿èƒ½
* `TE` = 1 â†’ å‘é€ä½¿èƒ½
* `RE` = 1 â†’ æŽ¥æ”¶ä½¿èƒ½

---

## 7. OPA (è¿ç®—æ”¾å¤§å™¨)

* åŸºåœ°å€ï¼š`0x4001 4000`
* å¸¸ç”¨å¯„å­˜å™¨ï¼š

  * `OPA_CSR` â€“ æŽ§åˆ¶å¯„å­˜å™¨

    * `OPAEN` â†’ ä½¿èƒ½
    * `MODE`  â†’ è·Ÿéšå™¨/æ”¾å¤§å€æ•° (Ã—1, Ã—2, Ã—5, Ã—10)
    * `PSEL`  â†’ æ­£ç«¯é€‰æ‹©
    * `NSEL`  â†’ è´Ÿç«¯é€‰æ‹©
    * `OUTEN` â†’ è¾“å‡ºä½¿èƒ½ (OPA\_OUTx å¼•è„š/è¿žåˆ°ADC)

---



> â€œè¿™é‡Œæ˜¯ PTM280x çš„å¤–è®¾å¯„å­˜å™¨è¡¨ï¼Œè¯·åœ¨æˆ‘å†™å¥½çš„åˆå§‹åŒ–æ¡†æž¶ä»£ç ä¸­ï¼Œç”¨å¯„å­˜å™¨çº§é…ç½®å¡«å…… `// TODO:` éƒ¨åˆ†ã€‚ä¾‹å¦‚å¯ç”¨æ—¶é’Ÿæ—¶å†™ RCC->APB2ENR |= (1<<11) è¿™æ ·çš„è¯­å¥ï¼Œé…ç½® TIM1 äº’è¡¥PWMã€ADCè§¦å‘ã€CMPæ¯”è¾ƒå™¨ã€UART0 é€šä¿¡ã€‚â€

---

