

# 📝 Copilot 自检 Prompt 模板

## 1. 工程级检查

* 请检查代码中是否还有任何 **warning**，确认编译时是否完全无警告。
* 请检查 **中断函数名称** 是否和启动文件的中断向量表匹配。

## 2. 时钟与电源

* 请确认系统时钟配置是否正确，目标主频 = `<你的目标频率>` MHz。
* 请确认 TIM1 的时钟分频是否正确，使 PWM 频率接近 `<目标频率，如100kHz>`。
* 请确认 ADC 的参考电压是否配置为 **5.0V (VDDA)**。

## 3. ADC / OPA / CMP

* 请检查 ADC 通道配置是否和引脚一致：

  * Vin → ADC0\_IN0 (PB12)
  * Vout → ADC0\_IN2 (PA2)
* 请检查 ADC 的触发源是否设置为 **TIM1 TRGO**，以便与 PWM 同步采样。
* 请检查 ADC 的采样时间是否满足 OPA 缓冲/分压电阻阻抗要求。
* 请检查 OPA 是否配置为 **电压跟随器**，输入 = PA3/PA4，输出 = PA5。
* 请检查 CMP1 是否配置为比较 Vin 与 60V 阈值（LDAC ≈ 3.0V），输出到 PA8。
* 请检查 CMP0 是否配置为比较 Vout 与 55V 阈值，输出到 PB4。

## 4. PWM (TIM1)

* 请检查 TIM1 是否配置为 **互补输出模式** (CH1/CH1N)。
* 请检查 TIM1\_CH1 是否输出到 PA5，CH1N 是否输出到 PA7。
* 请检查 TIM1\_BKIN 是否配置到 PB12，用于过流/保护信号输入。
* 请检查 PWM 的死区时间是否在 `<100~500ns>` 范围。
* 请检查 PWM 初始化时是否处于 **关闭状态**，不会在上电时直接输出。

## 5. 模式切换逻辑

* 请检查 CMP 中断服务函数里是否有 **ADC 二次确认/防抖**。
* 请检查 BUCK/BOOST 模式切换时是否先关闭 PWM，再重新配置。

## 6. UART 通信

* 请检查 UART0 是否使用 PA15 (TX) 与 PB2 (RX)。
* 请检查波特率是否配置为 `<115200 / 1Mbps>`，和从机匹配。
* 请检查是否有接收错误/超时处理，避免通信死锁。
* 请检查通信协议是否包含 CRC 或校验字段。

## 7. 异常与保护

* 请检查 BKIN 输入有效时，PWM 是否立即关闭（硬件通路保证）。
* 请检查 ADC 检测到过压/欠压/过流时是否进入保护状态。
* 请检查代码里是否启用了 **看门狗**，防止程序死机。
* 请检查是否有 **软启动逻辑**，PWM 占空比是否缓慢上升而不是瞬间全开。

## 8. 调试与日志

* 请检查代码里是否有 **Debug UART 或 LED 指示**，用于调试阶段状态确认。
* 请检查是否保留了 **故障状态码 / 错误日志**，便于调试和排错。


