# I2C PWM控制测试命令表

## 测试环境准备
- 从机地址: 0x50 (PB6=0, PB7=0)
- 连接: SDA=PB4, SCL=PB5
- 上拉电阻: 4.7kΩ

## 命令测试表

### 1. 基础功能测试

| 测试项目 | 命令 | 期望响应 | 实际响应 | 状态 |
|----------|------|----------|----------|------|
| 设置占空比194 | `0x01 0x00 0xC2` | `0xAA` | ___ | ☐ |
| 设置频率320 | `0x02 0x01 0x40` | `0xAA` | ___ | ☐ |
| 启动PWM | `0x03` | `0xAA` | ___ | ☐ |
| 查询状态 | `0x05` | `0xAA 0x01 0x00 0xC2 0x01 0x40` | ___ | ☐ |
| 停止PWM | `0x04` | `0xAA` | ___ | ☐ |
| 再次查询状态 | `0x05` | `0xAA 0x00 0x00 0xC2 0x01 0x40` | ___ | ☐ |

### 2. 边界值测试

| 测试项目 | 命令 | 期望响应 | 实际响应 | 状态 |
|----------|------|----------|----------|------|
| 最小占空比80 | `0x01 0x00 0x50` | `0xAA` | ___ | ☐ |
| 最大占空比320 | `0x01 0x01 0x40` | `0xAA` | ___ | ☐ |
| 最小频率240 | `0x02 0x00 0xF0` | `0xAA` | ___ | ☐ |
| 最大频率320 | `0x02 0x01 0x40` | `0xAA` | ___ | ☐ |

### 3. 错误处理测试

| 测试项目 | 命令 | 期望响应 | 实际响应 | 状态 |
|----------|------|----------|----------|------|
| 无效命令码 | `0xFF` | `0xFF` | ___ | ☐ |
| 数据长度不足 | `0x01 0x00` | `0xFF` | ___ | ☐ |
| 错误地址访问 | 发送到0x51 | 无响应 | ___ | ☐ |

## Linux i2c-tools测试命令

```bash
# 扫描I2C设备
i2cdetect -y 1

# 设置占空比194 (0x00C2)
i2cset -y 1 0x50 0x01 0x00 0xC2 i
i2cget -y 1 0x50

# 设置频率320 (0x0140)  
i2cset -y 1 0x50 0x02 0x01 0x40 i
i2cget -y 1 0x50

# 启动PWM
i2cset -y 1 0x50 0x03
i2cget -y 1 0x50

# 查询状态 (读取6字节)
i2cset -y 1 0x50 0x05
i2cdump -y 1 0x50 i | head -n 1

# 停止PWM
i2cset -y 1 0x50 0x04  
i2cget -y 1 0x50
```

## Arduino串口监视器测试

```cpp
// 在Arduino IDE串口监视器中输入以下命令进行测试

void serialTest() {
  if (Serial.available()) {
    String cmd = Serial.readString();
    cmd.trim();
    
    if (cmd == "set194") {
      setPWMDuty(194);
    }
    else if (cmd == "set320") {
      setPWMFreq(320);
    }
    else if (cmd == "start") {
      startPWM();
    }
    else if (cmd == "stop") {
      stopPWM();
    }
    else if (cmd == "status") {
      getPWMStatus();
    }
    else if (cmd == "test") {
      runFullTest();
    }
  }
}

void runFullTest() {
  Serial.println("=== PWM I2C 完整测试开始 ===");
  
  Serial.print("1. 设置占空比194...");
  if (setPWMDuty(194)) Serial.println("成功"); else Serial.println("失败");
  
  Serial.print("2. 设置频率320...");
  if (setPWMFreq(320)) Serial.println("成功"); else Serial.println("失败");
  
  Serial.print("3. 启动PWM...");
  if (startPWM()) Serial.println("成功"); else Serial.println("失败");
  
  Serial.println("4. 查询运行状态...");
  getPWMStatus();
  
  Serial.println("5. 等待3秒...");
  delay(3000);
  
  Serial.print("6. 停止PWM...");
  if (stopPWM()) Serial.println("成功"); else Serial.println("失败");
  
  Serial.println("7. 查询停止状态...");
  getPWMStatus();
  
  Serial.println("=== 测试完成 ===");
}
```

## 测试记录表

**测试日期**: ___________  
**测试人员**: ___________  
**硬件版本**: ___________  
**固件版本**: V1.0 (2025-09-28)

### 测试结果汇总

| 功能模块 | 通过/总数 | 成功率 | 备注 |
|----------|-----------|--------|------|
| 基础功能 | ___/6 | ___% | |
| 边界测试 | ___/4 | ___% | |
| 错误处理 | ___/3 | ___% | |
| **总计** | **___/13** | **___%** | |

### 问题记录

| 序号 | 问题描述 | 错误现象 | 解决方案 | 状态 |
|------|----------|----------|----------|------|
| 1 | | | | |
| 2 | | | | |
| 3 | | | | |

### 性能测试

| 测试项目 | 测试值 | 标准值 | 状态 |
|----------|--------|--------|------|
| I2C通信延迟 | ___ms | <10ms | |
| 命令响应时间 | ___ms | <5ms | |
| PWM启动时间 | ___ms | <1ms | |
| 参数更新时间 | ___ms | <1ms | |

### 测试环境

- **主控板**: ___________
- **I2C工具**: ___________  
- **示波器**: ___________
- **电源电压**: ___________V
- **环境温度**: ___________°C

### 签名确认

**测试完成**: □ 是 □ 否  
**功能正常**: □ 是 □ 否  
**可以发布**: □ 是 □ 否

**测试员签名**: ___________  
**日期**: ___________